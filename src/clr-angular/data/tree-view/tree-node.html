<!--
  ~ Copyright (c) 2016-2018 VMware, Inc. All Rights Reserved.
  ~ This software is released under MIT license.
  ~ The full license information can be found in LICENSE in the root directory of this project.
  -->

<div class="clr-tree-node-content-container">
  <button
    *ngIf="isExpandable() && !_model.loading && !expandService.loading"
    type="button"
    class="clr-treenode-caret"
    (click)="expandService.toggle()"
    [attr.aria-expanded]="expandService.expanded">
    <clr-icon
      class="clr-treenode-caret-icon"
      shape="caret"
      [attr.dir]="expandService.expanded ? 'down' : 'right'"
      [attr.title]="expandService.expanded ? commonStrings.collapse : commonStrings.expand"></clr-icon>
  </button>
  <div class="clr-treenode-spinner-container" *ngIf="expandService.loading || _model.loading">
        <span class="clr-treenode-spinner spinner"></span>
  </div>
  <div class="clr-checkbox-wrapper clr-treenode-checkbox" *ngIf="featuresService.selectable"
    [ngClass]="{'disabled': _model.disabled.value}">
    <input type="checkbox" id="{{nodeId}}-check" class="clr-checkbox" [attr.aria-labelledby]="nodeId"
           [checked]="_model.selected.value === STATES.SELECTED"
           [indeterminate]="_model.selected.value === STATES.INDETERMINATE">
    <!-- NOTE: The toggle selection handler is here instead of change on input above because, input change event happening
      on the DOM makes it hard for persisting the Indeterminate state on input by setting the 'checked' state 
      of the input to true even when it's false on the '_model.selected.value'. The DOM property bindings of the
      input element are messed up for programmatically persisting the indeterminate state -->
    <label for="{{nodeId}}-check" class="clr-control-label" 
      (click)="_model.toggleClickHandler(featuresService.eager, $event)">
    </label>
  </div>
  <div class="clr-treenode-content" [id]="nodeId">
    <ng-content></ng-content>
  </div>
</div>
<div class="clr-treenode-children"
     [@childNodesState]="expandService.expanded ? 'expanded' : 'collapsed'"
     [attr.role]="isExpandable() ? 'group' : null">
  <ng-content select="clr-tree-node"></ng-content>
  <ng-content select="[clrIfExpanded]"></ng-content>
  <clr-recursive-children [parent]="_model"></clr-recursive-children>
</div>
